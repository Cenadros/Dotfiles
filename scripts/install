#!/bin/bash
echo "ðŸ‘‰  Changing default terminal to zsh"
chsh -s $(which zsh) > /dev/null


echo "ðŸ‘‰  Installing docker"
case $(uname | tr '[:upper:]' '[:lower:]') in
  linux*)
    sudo apt-get update > /dev/null

    sudo apt-get install \
        ca-certificates \
        curl \
        gnupg \
        lsb-release -y > /dev/null

    sudo mkdir -p /etc/apt/keyrings
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

    echo \
      "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
      $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

    sudo apt-get update > /dev/null
    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y > /dev/null

    sudo groupadd docker
    sudo usermod -aG docker $USER
    ;;
  *)
    echo "Please refer to the official documentation for your Operating System: https://docs.docker.com/desktop/"
    echo -n "Would you like to proceed with the next steps? (y/n)"
    read reply

    if [ "$reply" = n -o "$reply" = N ]
    then
       exit
    fi
    ;;
esac

echo "ðŸ‘‰  Cloning prezto into: ${HOME}/.zprezto"
git clone --recursive https://github.com/sorin-ionescu/prezto.git "${HOME}/.zprezto" 2> /dev/null || git -C "${HOME}/.zprezto" pull

echo "ðŸ‘‰  Cloning prezto-contrib into: ${HOME}/.zprezto/contrib"
git clone --recurse-submodules https://github.com/belak/prezto-contrib "${HOME}/.zprezto/contrib" 2> /dev/null || git -C "${HOME}/.zprezto/contrib" pull

echo "ðŸ‘‰  Cloning nvm into: ${HOME}/.nvm"
git clone https://github.com/nvm-sh/nvm.git "${HOME}/.nvm" 2> /dev/null || git -C "${HOME}/.nvm" checkout `git -C "${HOME}/.nvm" describe --abbrev=0 --tags --match "v[0-9]*" $(git -C "${HOME}/.nvm" rev-list --tags --max-count=1)`

echo "ðŸ‘‰  Checking nvm latest version"
pushd ${HOME}/.nvm
  git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" $(git rev-list --tags --max-count=1)`
popd

bash "$HOME/.dotfiles/scripts/symlinks"

echo "ðŸ‘‰  Installing brew"
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

echo '# Set PATH, MANPATH, etc., for Homebrew.' >> ${HOME}/.zprofile
echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ${HOME}/.zprofile
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
sudo apt-get install build-essential -Y

echo "ðŸ‘‰  Installing mkcert"
brew install mkcert

echo "ðŸ‘‰  Installing make"
sudo apt install make -Y

echo "ðŸ‘‰  A system reboot is required to apply all changes"
echo -n "Would you like to proceed right now? (y/n)"
read reply

if [ "$reply" = y -o "$reply" = Y ]
then
   sudo reboot
else
   echo "Reboot cancelled"
fi
